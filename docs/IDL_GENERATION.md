# IDL Generation Documentation

## Overview

The Interface Definition Language (IDL) file is automatically generated by Anchor when you build the program. It describes the program's interface, including instructions, accounts, types, and events.

## Generation Process

### 1. Build the Program

```bash
cd anchor
anchor build
```

This generates the IDL at:
- **JSON IDL**: `anchor/target/idl/evidence_vault.json`
- **TypeScript Types**: `anchor/target/types/evidence_vault.ts`

### 2. Copy IDL to SDK

**Option A: Use the Makefile (Recommended)**
```bash
cd anchor
make copy-idl
```

**Option B: Use the script**
```bash
cd anchor
chmod +x scripts/copy-idl.sh
./scripts/copy-idl.sh
```

**Option C: Use Anchor script**
```bash
cd anchor
anchor run copy-idl
```

**Option D: Manual copy**
```bash
mkdir -p sdk/src/idl
cp anchor/target/idl/evidence_vault.json sdk/src/idl/
cp anchor/target/types/evidence_vault.ts sdk/src/idl/
```

### 3. One-step build and copy

```bash
cd anchor
make idl  # Builds and copies IDL
```

## IDL Structure

The generated IDL contains:

```json
{
  "version": "0.1.0",
  "name": "evidence_vault",
  "instructions": [...],
  "accounts": [...],
  "types": [...],
  "events": [...],
  "errors": [...]
}
```

### Key Sections

1. **instructions**: All program instructions with parameters and accounts
2. **accounts**: Account structures (Case, Evidence)
3. **types**: Custom types (CaseStatus, EvidenceType)
4. **events**: Event definitions for on-chain logging
5. **errors**: Error codes and messages

## Using the IDL in SDK

```typescript
import EvidenceVaultIDL from './idl/evidence_vault.json';
import { Program } from '@coral-xyz/anchor';

const program = new Program(EvidenceVaultIDL, programId, provider);
```

## IDL Versioning

When deploying new versions:

1. Build the new version
2. Copy the IDL to SDK
3. Update SDK if breaking changes exist
4. Commit both IDL changes and SDK updates together

## Troubleshooting

### IDL Not Generated
- Ensure `anchor build` completes without errors
- Check that `lib.rs` has valid Anchor macros
- Verify `declare_id!` macro is present

### TypeScript Types Missing
- Types are only generated when build succeeds
- Check for compilation errors in the Rust code
- Ensure anchor version is compatible

### SDK Import Errors
- Verify IDL was copied to `sdk/src/idl/`
- Check TypeScript `resolveJsonModule` is enabled
- Ensure file paths are correct in import statements
